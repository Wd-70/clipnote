[상세 설계서] ClipNote: AI & Meta-data 기반 클리핑 헬퍼 서비스1. 프로젝트 비전 및 핵심 철학"노트처럼 적으면 잘리는 영상": 무거운 영상 편집 프로그램 대신, 텍스트(타임라인) 기록만으로 컷 편집을 끝내는 가벼운 웹 서비스.가상 편집(Virtual Editing): 원본 영상을 건드리지 않고 재생 시점 제어(seekTo)만으로 편집본을 즉시 확인.비용 최적화 구조: 오디오 우선 분석과 글로벌 캐싱을 통해 AI 운영 비용을 최소화하고 수익을 극대화.2. 상세 기술 스택Framework: Next.js 14+ (App Router)Database: MongoDB Atlas (NoSQL의 유연함을 활용한 영상 메타데이터 및 분석 결과 저장)ODM: Mongoose (Schema 기반 데이터 모델링)Authentication: NextAuth.js (Google/Naver 로그인 및 MongoDB 어댑터 연동)Video Processing: * Frontend: hls.js, react-player (유튜브/치지직 플레이어 제어)Backend: FFmpeg, yt-dlp (부분 추출 및 클립 생성)AI Engine: Google Gemini 1.5 Flash (멀티모달 비디오/오디오 분석)Payment: Portone API (크레딧 결제 시스템)3. MongoDB 데이터 모델링 (상세)3.1 User (사용자 및 지갑)JavaScriptconst UserSchema = new mongoose.Schema({
  email: { type: String, required: true, unique: true },
  name: String,
  points: { type: Number, default: 0 }, // 1포인트 = 5원 (분당 1포인트 소모)
  role: { type: String, enum: ['FREE', 'PRO'], default: 'FREE' },
  savedChannels: [String], // 유료 유저용: 자동 수집할 채널 ID 목록
  createdAt: { type: Date, default: Date.now }
});
3.2 Project (편집 데이터)JavaScriptconst ProjectSchema = new mongoose.Schema({
  userId: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
  videoUrl: { type: String, required: true },
  platform: { type: String, enum: ['YOUTUBE', 'CHZZK'] },
  videoId: { type: String, required: true, index: true }, 
  title: String,
  // 사용자가 적은 메모 데이터
  notes: [{
    startTime: Number, // 초 단위 소수점
    endTime: Number,
    text: String,
    timestamp: { type: Date, default: Date.now }
  }],
  isAutoCollected: { type: Boolean, default: false } // 유료 기능을 통한 자동 수집 여부
});
3.3 AnalysisCache (수익 마진 보호를 위한 글로벌 캐시)JavaScriptconst AnalysisCacheSchema = new mongoose.Schema({
  videoId: { type: String, required: true, unique: true, index: true },
  platform: String,
  duration: Number, // 영상 총 길이(분) - 포인트 계산용
  // AI 분석 결과 (중복 분석 방지)
  analysisResult: {
    summary: String,
    highlights: [{
      start: Number,
      end: Number,
      reason: String,
      score: Number // 중요도 점수
    }]
  },
  cachedAt: { type: Date, default: Date.now }
});
4. 핵심 기능 로직 상세4.1 텍스트 파싱 및 플레이어 제어Regex 파싱: 사용자가 적은 01:20.5 - 01:35.0 형태의 텍스트를 감지하여 Float 형태의 초 단위로 변환합니다.가상 컷 기능: 플레이어의 currentTime을 0.1초 단위로 감시합니다. 현재 재생 중인 클립의 endTime에 도달하면 즉시 다음 메모된 클립의 startTime으로 seekTo()를 실행합니다.4.2 AI 분석 프로세스 (원가 절감 전략)Audio-First: 영상 전체를 분석하지 않고, 오디오 스트림만 먼저 Gemini Flash에 전달하여 중요 구간 후보를 텍스트로 뽑아냅니다.Selective Multimodal: AI가 지목한 후보 구간(전체의 약 5~10% 내외)만 저해상도 프레임 샘플링을 결합하여 정밀 멀티모달 분석을 수행합니다.수익화 로직: * 첫 요청자: 원가(약 210원/시간)를 소모하여 분석 후 DB에 캐싱.재요청자: DB에 저장된 데이터를 즉시 응답. 사용자에게는 동일한 300원(60포인트)을 과금하여 100% 수익으로 전환.4.3 영상 제작 (Export)무료: 복잡한 필터가 적용된 FFmpeg 한 줄 명령어를 팝업으로 제공하여 사용자가 자신의 PC에서 실행하도록 유도.유료: 서버에서 FFmpeg을 실행하여 원본의 해당 구간만 부분 다운로드 후 무인코딩 병합(-c copy)하여 .mp4 링크 제공.5. 포인트 및 비즈니스 모델포인트 단위: 1포인트 = 1분 분석권 = 5원 가치.판매 가격: $$300\text{원} = 60\text{포인트 (1시간 분석권)}$$종량제 상품:1,000원 충전 → 200포인트 (약 3.3시간)3,000원 충전 → 650포인트 (약 10.8시간, 보너스 포함)Pro 구독 (월 9,900원): * 등록 채널 영상 자동 수집 및 클라우드 동기화.서버사이드 클립 생성 기능 권한 부여.AI 분석 시 할인 혜택 제공.6. API 엔드포인트 설계 (Next.js API Routes)POST /api/analyze: 영상 ID를 받아 캐시 확인 후 AI 분석 수행 및 포인트 차감.GET /api/projects: 사용자의 편집 프로젝트 목록 조회.PATCH /api/projects/[id]: 실시간 메모(노트) 저장 및 동기화.POST /api/points/charge: 포트원 결제 성공 후 유저 포인트 업데이트.GET /api/chzzk/chat: 특정 다시보기의 채팅 로그 추출 및 화력 데이터 반환.7. 개발 AI에게 주는 요청 가이드"위 명세서를 바탕으로 Next.js에서 사용할 Mongoose 모델 정의 파일(models/AnalysisCache.ts)과, 사용자가 분석 버튼을 눌렀을 때 DB 캐시를 먼저 확인하고 없으면 Gemini API를 호출하여 결과를 저장하는 API 핸들러(app/api/analyze/route.ts)를 작성해 줘.특히, 분석 비용 리스크를 없애기 위해 영상 길이 1분당 1포인트를 차감하는 로직을 반드시 포함해 줘."